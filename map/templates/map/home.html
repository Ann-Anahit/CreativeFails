{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
    <link rel="stylesheet" href="{% static 'css/webfonts.css' %}">
    <title>Home - Creative Fails</title>
</head>

<body>
    <header>
        <div class="header-element">
            <nav>
                <ul>
                    <li><a href="{% url 'home' %}"><img class="logo" src="{% static 'images/logo_cf.png' %}"
                                alt="Logo"></a></li>
                    <li><a href="{% url 'write_article' %}">Write Article</a></li>
                    {% if user.is_authenticated %}
                    <li><a href="{% url 'logout' %}">Logout</a></li>
                    {% else %}
                    <li><a href="{% url 'login' %}">Login</a></li>
                    <li><a href="{% url 'register' %}">Register</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        <div class="hero">
            <h1>Creative Fails</h1>
        </div>
    </header>

    <main>
        {% if user.is_authenticated %}
        <h2>Welcome, {{ user.username }}!</h2>
        {% endif %}

        <div class="welcome">
            <h3>Welcome to Creative Fails,</h3>
            <p>Celebrating the art of failure. Here, setbacks in art and film inspire, not discourage. We learn from
                mistakes and support each other in our creative journeys. In a world focused on success, we uncover the
                valuable lessons in failure. Whether you're an artist, filmmaker, or creative, join our community to
                share challenges, learn from others, and grow together.</p>
        </div>

        <div class="blog-posts">
            <h2>Recent Posts</h2>
            {% for post in posts %}
            <article>
                <h3>{{ post.title }}</h3>
                <p>{{ post.content|truncatewords:30 }}</p>

                <!-- Display the post's image if available -->
                {% if post.image %}
                <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 300px; max-height: 300px;">
                {% else %}
                <p>No image available</p>
                {% endif %}

                <div class="meta">
                    Posted on <span class="date">{{ post.created_at|date:"Y-m-d H:i" }}</span> by <span
                        class="author">{{ post.user.username }}</span>
                </div>

                <!-- Likes functionality -->
                <form action="{% url 'post_like' post.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit">
                        {% if post.is_liked %}
                        Unlike
                        {% else %}
                        Like
                        {% endif %}
                    </button>
                </form>
                <p>{{ post.likes.count }} like(s)</p>

                <!-- Edit and delete buttons for post owner -->
                {% if post.user == user %}
                <p>
                    <a href="{% url 'edit_post' post.id %}">Edit Post</a> |
                    <a href="{% url 'delete_post' post.id %}">Delete Post</a>
                </p>
                {% endif %}
                <hr>

                <!-- Comments section -->
                <h4>Comments</h4>
                <div>
                    {% for comment in post.comments.all %}
                    <p><strong>{{ comment.user.username }}</strong>: {{ comment.content }}</p>
                    {% empty %}
                    <p>No comments yet.</p>
                    {% endfor %}
                </div>

                <!-- Add comment form -->
                <form action="{% url 'add_comment' post.id %}" method="POST">
                    {% csrf_token %}
                    <textarea name="content" placeholder="Add a comment..." required></textarea>
                    <button type="submit">Submit</button>
                </form>
            </article>
            <hr>
            {% empty %}
            <p>No posts yet.</p>
            {% endfor %}
        </div>
    </main>

    <footer>
        <a href="https://www.twitter.com/" target="_blank" rel="noopener" aria-label="Visit our Twitter page">
            <img src="{% static 'images/x-twitter.png' %}" alt="Twitter" class="social">
        </a>
        <a href="https://github.com" aria-label="Open-source code on GitHub" target="_blank">
            <img src="{% static 'images/github.png' %}" alt="GitHub" class="social">
        </a>
        <a href="https://www.instagram.com/" target="_blank" rel="noopener" aria-label="Visit our Instagram page">
            <img src="{% static 'images/instagram.png' %}" alt="Instagram" class="social">
        </a>
    </footer>
</body>

</html>