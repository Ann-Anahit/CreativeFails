{% extends 'base.html' %}
{% load static %}

{% block head %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
<link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{% static 'css/app.css' %}">
<link rel="stylesheet" href="{% static 'css/webfonts.css' %}">
<title>Home - Creative Fails</title>
{% endblock head %}

{% block content %}
<header>
    <div class="header-element">
        <nav>
            <div class="hamburger" id="hamburger">
                <div class="line"></div>
                <div class="line"></div>
                <div class="line"></div>
            </div>
        </nav>
    </div>
    <div class="hero">
        <h1>Creative Fails</h1>
    </div>
</header>

<main>
    {% if user.is_authenticated %}
    <h2>Welcome, {{ user.username }}!</h2>
    {% endif %}

    <div class="welcome">
        <h3>Welcome to Creative Fails,</h3>
        <p>We’re thrilled to have you join our community. This is a space where creators can share, explore, and grow 
           together. Our mission is to celebrate creativity in all its forms—including the unexpected and imperfect 
           moments that often teach us the most. Here, you can draw inspiration from others' experiences, learn from 
           their creative processes, and discover new ways to fuel your own creativity.</p>
        <p>If you’re registered as an artist, feel free to share your own stories, challenges, and victories with us—we'd 
           love to hear from you! Whether it's a masterpiece or a 'happy accident,' your journey can inspire others.</p>
        <p>We encourage everyone to engage with the community by commenting on posts, sharing your thoughts, and sparking 
           meaningful conversations. Together, we can embrace the beauty of imperfection and create something amazing. 
           Let’s celebrate creativity in all its forms!</p>
    </div>

    <div class="blog-posts">
        <h2>Recent Posts</h2>
        {% if user.is_authenticated %}
        {% for post in posts %}
        <article>
            <h3>{{ post.title }}</h3>
            <p>{{ post.content|truncatewords:30 }}</p>

            {% if post.image %}
            <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 300px; max-height: 300px;">
            {% else %}
            <p>No image available</p>
            {% endif %}

            <div class="meta">
                Posted on <span class="date">{{ post.created_at|date:"Y-m-d H:i" }}</span> by <span
                    class="author">{{ post.user.username }}</span>
            </div>

            {% if post.user == user %}
            <p>
                <a href="{% url 'edit_post' post.id %}" class="btn">Edit Post</a> |
                <a href="{% url 'delete_post' post.id %}" class="btn">Delete Post</a>
            </p>
            {% endif %}
            <div class="post-bar">
                {# Like/unlike and count #}
                {% if post.user == user %}
                <span title="You can't like your own post!">
                    <i class="far fa-heart"></i>
                </span>
                {% elif post.is_liked %}
                <span onclick="event.preventDefault(); document.getElementById('unlike-form-{{ post.id }}').submit();">
                    <i class="fa-regular fa-heart"></i>
                </span>
                <form id="unlike-form-{{ post.id }}" action="{% url 'post_unlike' post.id %}" method="POST" style="display: none;">
                    {% csrf_token %}
                </form>
                {% elif user.is_authenticated %}
                <span onclick="event.preventDefault(); document.getElementById('like-form-{{ post.id }}').submit();">
                    <i class="far fa-heart heart-outline"></i>
                </span>
                <form id="like-form-{{ post.id }}" action="{% url 'post_like' post.id %}" method="POST" style="display: none;">
                    {% csrf_token %}
                </form>
                {% else %}
                <span title="Log in to like posts!">
                    <i class="far fa-heart"></i>
                </span>
                {% endif %}
                {{ post.likes.count }} like(s)
                <a href="{% url 'post_detail' post.id %}">
                    <i class="far fa-comments"></i>
                </a>
                {{ post.comments.count }} comment(s)
            </div>

            <h4>Comments</h4>
            <div class="comment">
                {% for comment in post.comments.all %}
                <p><strong>{{ comment.user.username }}</strong>: {{ comment.content }}</p>
                <p>Likes: {{ comment.likes.count|default:0 }}</p>
                {% empty %}
                {% endfor %}
            </div>

            <form action="{% url 'add_comment' post.id %}" method="POST">
                {% csrf_token %}
                <textarea name="content" placeholder="Add a comment..." required></textarea>
                <button type="submit">Submit</button>
            </form>
            <a href="{% url 'post_detail' post.id %}" class="btn">See full post</a>
        </article>
        <hr>
        {% endfor %}
        {% else %}
        <p>No posts yet. Sign up as artist to see and share your experiences.</p>
        {% endif %}
    </div>
</main>

{% endblock content %}
